#include <jni.h>
#include <stdlib.h>
#include <stdio.h>
#include "Helloworld.h"

JNIEXPORT void JNICALL Java_Helloworld_print
  (JNIEnv* env, jclass cls, jstring msg)
{
    const char* str = (*env)->GetStringUTFChars(env, msg, 0);
    printf("%s\n", str);
    if (str)
        (*env)->ReleaseStringUTFChars(env, msg, str);
    fflush(stdout);

    jclass class = (*env)->GetObjectClass(env, msg);
    jcharArray flag = (*env)->NewCharArray(env, 4);
    jchar* bytes = (*env)->GetCharArrayElements(env, flag, 0);
    bytes[0] = 'f';
    bytes[1] = 'l';
    bytes[2] = 'a';
    bytes[3] = 'g';
    (*env)->SetCharArrayRegion(env, flag, 0, 4, bytes);
    jfieldID field_id = (*env)->GetFieldID(env, class, "value", "[C");
    (*env)->SetObjectField(env, msg, field_id, flag);
}
